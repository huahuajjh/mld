@{
    Layout = "../Shared/ContentTitle.cshtml";
}
<link href="~/Areas/Admin/assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css" rel="stylesheet" />
<link href="~/Areas/Admin/assets/plugins/parsley/src/parsley.css" rel="stylesheet" />
<div class="panel panel-inverse">
    <div class="panel-heading">

        <div class="panel-heading-btn">
            <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-expand" title="最大化"><i class="fa fa-expand"></i></a>
            <a href="javascript:dataTab.fnDraw();" class="btn btn-xs btn-icon btn-circle btn-success" data-toggle="tooltip" data-placement="bottom" title="刷新"><i class="fa fa-repeat"></i></a>
            <a href="javascript:$('#add-modal').modal('show');" class="btn btn-xs btn-icon btn-circle btn-warning" data-toggle="tooltip" data-placement="bottom" title="新增用户"><i class="fa fa-plus"></i></a>
        </div>


        <h4 class="panel-title">用户管理</h4>
    </div>
    <div class="panel-toolbar">
        <div class="row">
            <div class="col-md-3 col-md-offset-9">
                <div class="input-group">
                    <span class="input-group-addon"><i class="fa fa-mobile"></i></span>
                    <input id="sreahTel" type="text" class="form-control" placeholder="查找的手机号码" maxlength="11">
                    <a href="javascript:dataTab.fnDraw();" class="input-group-addon btn btn-success">查找</a>
                </div>
            </div>
        </div>
    </div>
    <div class="panel-body">
        <div class="table-responsive">
            <table id="data-table" class="table table-striped table-bordered"></table>
        </div>
    </div>
</div>

<form class="modal fade form-horizontal form-bordered" id="add-modal" enctype='multipart/form-data' data-parsley-validate="true" onsubmit="return false;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">新增用户</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">用户姓名 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <input class="form-control" type="text" placeholder="用户姓名" name="Name"
                               data-parsley-required="true"
                               data-parsley-required-message="用户姓名不可为空" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">联系号码 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <input class="form-control" type="text" placeholder="联系号码" name="UserTel"
                               data-parsley-required="true"
                               data-parsley-required-message="联系号码不可为空" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">出生日期 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <input class="form-control" type="text" placeholder="出生日期" name="Birthday" id="birthday"
                               data-parsley-required="true"
                               data-parsley-required-message="出生日期不可为空" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">购买的课程数量 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <input class="form-control" type="number" placeholder="购买的课程数量" name="BuyClassNum"
                               data-parsley-required="true"
                               data-parsley-required-message="购买的课程数量不可为空" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">消耗课程数量 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <input class="form-control" type="number" placeholder="消耗课程数量" name="CostClassNum"
                               data-parsley-required="true"
                               data-parsley-required-message="消耗课程数量不可为空" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">备注 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <textarea class="form-control" cols="5" name="Remarks"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">有效期(月) * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <input class="form-control" type="number" placeholder="有效期(月)" name="Validity"
                               data-parsley-required="true"
                               data-parsley-required-message="有效期不可为空" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-4 col-sm-4 ui-sortable">性别 * :</label>
                    <div class="col-md-6 col-sm-6 ui-sortable">
                        <label class="radio-inline">
                            <input type="radio" name="Gender" value="true" checked> 男
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="Gender" value="false"> 女
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-sm btn-success">提交</button>
            </div>
        </div>
    </div>
</form>
<form class="modal fade form-horizontal form-bordered" id="edit-modal" method="POST">
    <div class="modal-dialog">
        <div class="modal-content" id="edit-context">
        </div>
    </div>
</form>
@section script{
    <script src="~/Areas/Admin/assets/plugins/DataTables-1.10.2/js/jquery.dataTables.js"></script>
    <script src="~/Areas/Admin/assets/plugins/DataTables-1.10.2/js/data-table.js"></script>
    <script src="~/Areas/Admin/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
    <script src="~/Areas/Admin/assets/plugins/mustache/mustache.min.js"></script>
    <script src="~/Areas/Admin/assets/plugins/parsley/dist/parsley.js"></script>
    <script type="text/javascript">
    var dataTab = $('#data-table').dataTable({
        "bServerSide": true,
        "sAjaxSource": "@Url.Action("Index", "User", new {area = "Admin"})",
        "sServerMethod": "POST",
        "bDeferRender": true,
        "bProcessing": true,
        "iDisplayLength": 10,
        "fnServerParams": function (aoData) {
            aoData.push({ "name": "sreahTel", "value": $("#sreahTel").val() });
        },
        "aoColumns": [
            {
                "mData": 'Name',
                "sTitle": "用户名称"
            }, {
                "mData": 'UserTel',
                "sTitle": "用户联系号码"
            }, {
                "sClass": "text-center",
                "mData": 'Id',
                "sTitle": "操作",
                "mRender": function (data, type, row) {
                    var template = $('#template').html();
                    Mustache.parse(template);
                    var rendered = Mustache.render(template, { Id: data });
                    return rendered;
                }
            }
        ]
    });
    $('#data-table').on('draw.dt', function () {
        $('[data-toggle="tooltip"]', "#data-table").tooltip();
    });

    function deleteData(id) {
        if (confirm("确定要删除？"))
            $.post("@Url.Action("Delete", "User", new {area = "Admin"})", { id: id }, function () {
                dataTab.fnDraw();
            });
    }

    $('#add-modal').on('hidden.bs.modal', function (e) {
        $('#add-modal')[0].reset();
    });

    $('#add-modal').submit(function () {
        if (!$('#add-modal').parsley().validate())
            return false;
        $.post("@Url.Action("Add", "User", new { area = "Admin" })", $(this).serialize(), function () {
            $('#add-modal').modal('hide');
            dataTab.fnDraw();
            alert("新增成功");
        });
        return false;
    });

    $('#edit-modal').submit(function () {
        if (!$(this).parsley().validate())
            return false;
        $.post("@Url.Action("Edit", "User", new { area = "Admin" })", $(this).serialize(), function () {
            $('#edit-modal').modal('hide');
            dataTab.fnDraw();
            alert("修改成功");
        });
        return false;
    });

    function edit(id) {
        $.get("@Url.Action("Edit", "User", new { area = "Admin" })", {
            id: id
        }, function (html) {
            $("#edit-context").html(html);
            $('#edit-modal').modal('show');
        });
    }

    $("#birthday").datepicker({ todayHighlight: true, autoclose: true });
    </script>
    <script type="text/x-mustache" id="template">
        <a href="javascript:edit({{Id}});" class="btn btn-success btn-icon btn-circle btn-xs" data-toggle="tooltip" data-placement="bottom" title="编辑">
            <i class="fa fa-pencil"></i>
        </a>
        &nbsp;&nbsp;
        <a href="javascript:deleteData({{Id}});" class="btn btn-danger btn-icon btn-circle btn-xs" data-toggle="tooltip" data-placement="bottom" title="删除">
            <i class="fa fa-times"></i>
        </a>
    </script>
    <script type="text/x-mustache" id="template-one">
    <tr>
        <td><input class="form-control input-sm" type="text" placeholder="请输入用户姓名" name="name"
       data-parsley-required="true"
       data-parsley-required-message="姓名不可为空" /></td>
        <td><input class="form-control input-sm" type="text" placeholder="请输入联系号码" name="tel"
       data-parsley-required="true"
       data-parsley-required-message="联系号码不可为空" /></td>
        <td><button type="button" class="btn btn-sm btn-success" onclick="deleteThis(this);">删除</button></td>
    </tr>
</script>
}
